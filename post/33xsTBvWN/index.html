<html>
<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Onedata-3, 节省数据成本——到数据资产 | staticor in data</title>

<link rel="shortcut icon" href="https://staticor.github.io/favicon.ico?v=1655881153291">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://staticor.github.io/styles/main.css">
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"> -->

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.12.0/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.12.0/languages//dart.min.js"></script>

<!-- <script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script> -->
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
    
        <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.1/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script> 
    
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <a class="navbar-brand" href="/">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            staticor in data
        </div>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" id="changeNavbar">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
            <div class="nav-item">
                
                <a href="/" class="menu gt-a-link">
                    首页
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/archives" class="menu gt-a-link">
                    归档
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/tags" class="menu gt-a-link">
                    标签
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/post/about" class="menu gt-a-link">
                    关于
                </a>
                
            </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1655881153291"
                action="/search/">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>
<script>
    /* 移动端导航栏展开/收起切换 */
    document.getElementById('changeNavbar').onclick = () => {
        var element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else {
            element.style.display = 'none';
        }
    }
</script>

    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    Onedata-3, 节省数据成本——到数据资产
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2022-06-09 ·
                    </time>
                    
                </div>
                <div class="post-content">
                    <p>数据中心是成本中心，要在有限资源内，最大化的完成精细化运营的决策支撑任务，所以会尽可能地完成业务方的合理需求； 与此同时，也会受到整体技术产研的“资源帽”的要求，要不断的节省成本。</p>
<p>成本分为人员成本和集群成本，人员成本可估算为60-80万（人民币一年）； 集群成本可按一个&lt;core+Memory&gt;对来描述，和公司采买机器的偏好有关（memory: core 越高说明是内存计算型的任务更高）一般这个比例是在4:1 到2:1之间。</p>
<p>成本花在什么地方了？<br>
在建设数据中台的过程中，数据仓库的建设、日常数据挖掘与分析、数据产品开发，都是由数据团队的人+机器完成的。 在开心过程中，要小心一些成本陷阱。</p>
<h1 id="提防成本陷阱">提防成本陷阱</h1>
<p>能够监测到每个报表的使用情况</p>
<ul>
<li>制定数据下线规则</li>
</ul>
<p>其实，以我的过往经验来看，数据团队产生的数据报表有一多半是30天内无人查看的，三成以上是近90天无人查看的。</p>
<p>这个原因也很好理解，核心报表（与业务方的日报、周报、月报有关）是业务方每天关注的，但更多的生产报表有它的历史任务，过了那段业务高峰，业务方就会转移到新注意力；</p>
<p>随着时间的积累，就导致这些历史报表的地位变得很难受。</p>
<ul>
<li>
<p>衡量一张表的投入产出比</p>
<p>还是那句话，对于成本优化来说，如果不能给出量化的策略，就难以优化。<br>
在数据仓库任务中，每张表的加工成本可以根据集群使用情况用金额评定；</p>
<p>但难点是一张表的收益如何量化呢？</p>
<ul>
<li>烟囱式开发</li>
</ul>
</li>
</ul>
<p>即数据重复加工，团队里每个人各自开发了若干个数据烟囱，没有复用，造成资源的巨大浪费。</p>
<ul>
<li>数据倾斜</li>
</ul>
<p>数据开发优化，应在开发流程上加以优化，避免不合理任务的上线。</p>
<ul>
<li>数据存储</li>
</ul>
<p>对数据管理来说，应对每张表设置存储策略，引入定期删除机制，降低存储。</p>
<p>同时还应对远期表引入冷热表分离和压缩机制，进一步降低存储成本。</p>
<ul>
<li>调度周期</li>
</ul>
<figure data-type="image" tabindex="1"><img src="https://staticor.github.io/post-images/1654738079892.png" alt="" loading="lazy"></figure>
<p>（图片来自 极客时间-《数据中台实战课》）</p>
<p>在我之前接触的团队，数据调度也是类似的，从凌晨开始，持续到上午的6点或8点，完成当天ETL任务， 在白天则基本上服务于一些ad-hoc即席查询，集群的使用率不到四分之一。</p>
<p>因为一般情况，业务方会默认的以为每天上班后看到的数据就是当天准确的，所以很难再和业务同事商量下午2点再看数据，这不现实。</p>
<h1 id="精细化成本管理">精细化成本管理</h1>
<p>—— 核心工作在于数据资产门录的建设。</p>
<p>早期数据仓库是开发开发，上线上线，修bug维护等一系列工作下来，在这个阶段是没有成本意识的，更不会量化一张数仓表到底投入了多少总成本。</p>
<p><img src="https://staticor.github.io/post-images/1654757168577.png" alt="" loading="lazy"><br>
（图片来自 极客时间-《数据中台实战课》）</p>
<p>一张数仓报表的财务分析示例，<br>
依赖成本：在这个图中 表A 依赖上游的六个表、三个开发任务 = 开发任务各自的执行成本 ，存储成本是6个报表的存储成本。<br>
开发成本：自身生产任务的执行成本，按CU占用时间评估执行成本； 存储成本，按该表存储占用一年来估算一年的成本；</p>
<p>数据价值如何体现？</p>
<blockquote>
<p>再有价值的数据，如果只有开发人员关注，而无业务人员问津，也是不对的。</p>
</blockquote>
<p>末端数据应用分类：</p>
<ul>
<li>应用层表（对接展示类或者特定业务场景应用），使用范围（谁在使用）+使用频率（使用强度）；</li>
<li>轻度汇总或集市层（用于探索分析），使用范围（谁在使用）+使用频率（使用强度）；</li>
</ul>
<p>一开始，并不一定需要对每个报表，每个数仓中间层表都准确维护。<br>
但数据资产盘点工作应至少把数据的使用分为三类：</p>
<ul>
<li>第一类：持续占用成本资源，无人过问。</li>
<li>第二类，ROI不匹配的数据报表，高投入低产出</li>
<li>第三类，高成本数据，以一个参考线往上</li>
</ul>
<p>前两类对应的是下线报表策略。</p>
<h2 id="数据下线策略">数据下线策略</h2>
<p>这里要注意的是，下线策略并不是突然间将报表从任务调度停止，删除历史数据，这样的一刀切太过危险。<br>
应使用温和的下线策略：</p>
<ul>
<li>
<ol>
<li>在数据地图上标识这个表的状态为下线观察期（7-30天），如果有用户反应还会使用，则根据使用情况进行调整 （放弃下线，或者引导用户使用其他表）；</li>
</ol>
</li>
<li>
<ol start="2">
<li>观察期过后，更新状态为已下线——停止生产，新数据不再写入；</li>
</ol>
</li>
<li>
<ol start="3">
<li>如果集群分为主集群和备用集群，则将数据移到冷备集群，一般来说冷备集群不负责数据密集型计算，主要以备份和数据存储为主。</li>
</ol>
</li>
<li>
<ol start="4">
<li>再经历过一段时间，还无人反馈，则数据删除，更新数据字典状态。</li>
</ol>
</li>
</ul>
<h2 id="数据存储策略">数据存储策略</h2>
<p>数据存储周期设置</p>
<ul>
<li>永久级</li>
<li>非永久级，
<ul>
<li>短期， 只保留最近7天分区</li>
<li>中期， 保留最近30天分区</li>
<li>长期，保留最近180天， 一年分区</li>
</ul>
</li>
</ul>
<h1 id="衡量数据成本治理的方式">衡量数据成本治理的方式</h1>
<p>开发维度同样的任务，是否可以节省更多的机器资源。</p>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">下一篇</div>
                <a href="https://staticor.github.io/post/onedata-2-shu-ju-chu-cuo-liao/" class="post-title gt-a-link">
                    Onedata-2 数据出错了
                </a>
            </div>
        

        

        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">To Think   You Have to Write</div>
    <div class="social-container">
        
            
                <a href="github.com/staticor" target="_blank">
                    <i class="fab fa-github gt-c-content-color-first"></i>
                </a>
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        Powered by <a href="https://github.com/staticor" target="_blank">staticor @ github </a>
    </div>
    <div>
        Theme <a href="https://github.com/imhanjie/gridea-theme-pure" target="_blank">Pure</a>, Powered by <a
                href="https://gridea.dev" target="_blank">Gridea</a> | <a href="https://staticor.github.io/atom.xml" target="_blank">RSS</a>
    </div>
</div>

<script>
  hljs.highlightAll()
</script>

    </div>
</div>
</body>
</html>
